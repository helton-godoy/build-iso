#!/bin/bash

# Cores
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Caminhos
REPO_ROOT="$(git rev-parse --show-toplevel)"
ROUTER="${REPO_ROOT}/.agent/scripts/task_router.py"
COMMITTER="${REPO_ROOT}/.agent/scripts/smart_commit.py"

# 1. Captura a instru√ß√£o do usu√°rio
QUERY="$*"

if [[ -z ${QUERY} ]]; then
	echo 'Uso: g-task "Sua instru√ß√£o para o agente"'
	exit 1
fi

echo -e "${BLUE}===== üß† AN√ÅLISE DE CONTEXTO (Pr√©-Agente) =====${NC}"

# 2. Executa o Router para preparar o terreno
# Isso imprime as instru√ß√µes que o voc√™ (usu√°rio) vai copiar/colar ou que o agente vai ver se for pipeado
python3 "${ROUTER}" "${QUERY}"

echo -e "${BLUE}===============================================${NC}"
echo -e "${GREEN}üöÄ Iniciando intera√ß√£o com o Agente...${NC}"

# 3. AQUI entraria a chamada do agente.
# Como o Gemini CLI √© interativo, voc√™ provavelmente quer rodar isso e depois entrar no chat.
# OU, se voc√™ usa o modo one-shot (n√£o-interativo), seria: gemini "$QUERY"
# Vou assumir que voc√™ quer ver o output do router e depois entrar no shell ou mandar o comando.

# Op√ß√£o A: Apenas imprime o contexto e espera voc√™ rodar o comando do agente
echo ""
echo "üí° DICA: Copie o contexto acima se necess√°rio, ou confie que o agente ler√° o hist√≥rico recente."
echo "Execute sua tarefa no Gemini CLI agora."
echo ""
echo "Pressione [ENTER] quando o agente tiver terminado a tarefa para realizar o Smart Commit."
read -p ""

# 4. P√≥s-Execu√ß√£o: Smart Commit
echo -e "${BLUE}===== üíæ FINALIZANDO TAREFA (Smart Commit) =====${NC}"
python3 "${COMMITTER}"
